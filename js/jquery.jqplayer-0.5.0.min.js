/*

	jQPlayer - HTML 5 Video Player Plugin for jQuery
	Version: 0.5
	Site: http://jqplayer.vebersol.net/
	
	Author: Vin√≠cius Ebersol
	Designer: Thiago Reis
	
	License: MIT License/GPL License
	
*/
var options;(function(a){var b=function(a,b){this.selector=a;this.options=b;this.idCounter=0;this.playing=false;this.init()};b.prototype={init:function(){this.getDefaultVideo();this.createVideoElement();this.createControls();this.bindControls();this.bindEvents();this.setupSubtitles();if(this.options.onStart){this.options.onStart.call()}},adjustSubtitle:function(a){this.subtitleObj.count=0;this.subtitleObj.current=this.subtitleObj.content[this.subtitleObj.count];var b=parseFloat(a.currentTime);while(this.getMaxTime()<b){this.updateSubtitle(a);if(this.subtitleObj.count>this.subtitleObj.content.length-1){this.subtitleObj.count=this.subtitleObj.content.length-1;break}}},bindControls:function(a){var b=this;for(var c=0;c<this.options.controls.length;c++){switch(this.options.controls[c]){case"play":this.selector.find(b.getClass("play")).bind("click",function(){b.playPause()});break;case"progress":this.setupProgressBar();break;case"volume":this.selector.find(b.getClass("volume-button")).bind("click",function(){b.muteVideo()});break;case"fullscreen":this.selector.find(b.getClass("fullscreen")).bind("click",function(){b.toFullscreen()});break;default:break}}},bindEvents:function(){var b=this;var c=this.video.get(0);c.addEventListener("loadedmetadata",function(){if(a.inArray("progress",b.options.controls)){b.setProgressEvents(this)}if(a.inArray("time",b.options.controls)){b.setupTime()}if(a.inArray("volume",b.options.controls)){b.volumeSetup()}},true);if(a.browser.webkit){a(document).bind("webkitfullscreenchange",function(){b.fullscreenEvent()})}else if(a.browser.mozilla){a(document).bind("mozfullscreenchange",function(){b.fullscreenEvent()})}var d=function(){a(this).addClass("hover")};var e=function(){a(this).removeClass("hover")};a(this.getClass("play")).hover(d,e);a(this.getClass("volume")).hover(d,e);a(this.getClass("fullscreen")).hover(d,e);a(this.getClass("alternative-versions")).hover(d,e);this.selector.bind("mouseleave",function(a){a.preventDefault();if(b.playing){clearTimeout(b.inactivateTimer);b.inactivateTimer=setTimeout(function(){b.selector.find(b.getClass("video-controls")).addClass("inactive")},2e3)}});this.selector.bind("mouseenter",function(a){a.preventDefault();clearTimeout(b.inactivateTimer);b.selector.find(b.getClass("video-controls")).removeClass("inactive")})},blockSelection:function(){document.onselectstart=function(){return false}},changeVideoSource:function(b){var c=a(b).parent().parent().parent();currentVersion=c.attr("class").replace(this.setClass("alternative-versions")+" ","");var d=c.find(this.getClass("current-version"));var e=a(b).parent().attr("class").replace("."+this.options.prefix+"alternative-","");if(currentVersion!=e){var f=this.options.videos[e];d.html(f.label);d.parent().removeClass(currentVersion).addClass(e);video=this.video.get(0);video.pause();this.resetVideo();video.src=this.getVideoSource(f);var g=a(this.getClass("alternative-versions")).find("ul");g.html("");for(e in this.options.videos){var h=this.options.videos[e];if(h!=f){if(h.source){var i=a('<li class="'+this.getClass("alternative-"+e)+'"><a href="javascript:;"><span></span></a></li>');if(h.label){i.find("span").html(h.label)}var j=this;i.find("a").bind("click",function(){j.changeVideoSource(this)});g.append(i)}}}var j=this;video.addEventListener("loadedmetadata",function(){this.play();if(j.options.onVideoChange){j.options.onVideoChange.call()}},true)}},createAlternative:function(){var b=a('<div class="'+this.setClass("alternative-versions")+'"></div>');b.append('<span class="'+this.setClass("current-version")+'">'+this.defaultVideo.label+"</span>");b.append("<ul></ul>");for(alternative in this.options.videos){var c=this.options.videos[alternative];if(c!=this.defaultVideo){if(c.source){var d=a('<li class="'+this.getClass("alternative-"+alternative)+'"><a href="javascript:;"><span></span></a></li>');if(c.label){d.find("span").html(c.label)}var e=this;d.find("a").bind("click",function(){e.changeVideoSource(this)});b.find("ul").append(d)}}else{b.addClass(alternative)}}return b},createButton:function(b,c){var d=a("<div>").addClass(this.setClass(c));var e=a("<span>").html(b);d.append(e);return d},createClearFloats:function(){return'<div style="clear:both;width:0;height:0;margin:0;padding:0;"><!-- --></div>'},createControls:function(){this.controls=a("<div>").addClass(this.setClass(this.options.controlsClass));for(var b=0;b<this.options.controls.length;b++){switch(this.options.controls[b]){case"play":var c=this.createButton("Play/Pause","play");this.controls.append(c);break;case"progress":var d=this.createProgressBar();this.controls.append(d);break;case"time":var e=this.createTimeDisplay();this.controls.append(e);break;case"volume":var f=this.createVolumeBar();this.controls.append(f);break;case"fullscreen":if(a.browser.webkit||a.browser.mozilla){var g=this.createButton("Fullscreen","fullscreen");this.controls.append(g)}break;case"alternative":var h=this.createAlternative();this.controls.append(h);break;default:var i=this.createCustomButton(this.options.controls[b]);this.controls.append(i);break}}this.controls.append(this.createClearFloats());this.selector.append(this.controls)},createCustomButton:function(b){var c=null;var d=this.options.customButtons[b];if(d){if(d.url){c=a('<div><a href="'+d.url+'"></a></div>');if(d.label)c.find("a").html(d.label);if(d.className){c.addClass(d.className)}if(d.target){c.find("a").attr("target",d.target)}}else if(d.onclick){c=a('<div><a href="javascript:;"></a></div>');c.find("a").bind("click",d.onclick);if(d.className)c.addClass(d.className);if(d.label)c.find("a").html(d.label)}c.addClass(this.setClass("custom-button"));return c}return false},createProgressBar:function(){var b=a("<div>").addClass(this.setClass("progress-bar"));var c=a("<div>").addClass(this.setClass("progress-wrapper"));var d=a("<div>").addClass(this.setClass("progress-play"));var e=a("<div>").addClass(this.setClass("progress-pointer"));var f=a("<div>").addClass(this.setClass("progress-buffer"));c.append(d);c.append(e);c.append(f);c.append(this.createClearFloats());b.append(c);return b},createTimeDisplay:function(){var b=a("<div>").addClass(this.setClass("time-display"));var c=a("<div>").addClass(this.setClass("time-current"));var d=a("<div>").addClass(this.setClass("time-separator"));var e=a("<div>").addClass(this.setClass("time-total"));b.append(c);b.append(d);b.append(e);return b},createVideoElement:function(){this.video=a("<video>Your browser doesn't support video tag.</video>");this.video.attr("src",this.getVideoSource());this.video.width("100%");this.video.height("100%");if(this.defaultVideo.subtitle){this.video.append('<track src="'+this.defaultVideo.subtitle+'"></track>')}a(this.selector).append(this.video)},createVolumeBar:function(){var b=a("<div>").addClass(this.setClass("volume"));var c=a("<div>").addClass(this.setClass("volume-button")).html("Volume");var d=a("<div>").addClass(this.setClass("volume-bar"));var e=a("<div>").addClass(this.setClass("volume-icon-plus")).html("+");var f=a("<div>").addClass(this.setClass("volume-wrapper"));var g=a("<div>").addClass(this.setClass("volume-position"));var h=a("<div>").addClass(this.setClass("volume-icon-less")).html("-");f.append(g);d.append(e);d.append(f);d.append(h);b.append(c);b.append(d);return b},findPosX:function(a){a=a.get(0);var b=a.offsetLeft;while(a=a.offsetParent){b+=a.offsetLeft}return b},findPosY:function(a){a=a.get(0);var b=a.offsetTop;while(a=a.offsetParent){b+=a.offsetTop}return b},formatTime:function(a){var b=Math.floor(a/60);var c=Math.round(a-b*60);if(c==60){c=0;b=b+1}if(c<10){c="0"+c}return b+":"+c},fullscreenEvent:function(){this.setupProgressBar();var b=a(this.getClass("fullscreen"));b.toggleClass("fullscreen");this.selector.toggleClass("fullscreen")},getClass:function(a){return"."+this.options.prefix+a},getControlsSize:function(){var b=0;var c=this;this.selector.find(this.getClass("video-controls")).children().each(function(){var d=a(this);if(!d.hasClass(c.setClass("progress-bar"))){b+=d.outerWidth()}});return b},getDefaultVideo:function(){if(this.options.videos[this.options.defaultVideo]){this.defaultVideo=this.options.videos[this.options.defaultVideo];return this.defaultVideo}for(var a in this.options.videos){this.defaultVideo=this.options.videos[a];return this.defaultVideo}},getMaxTime:function(){if(typeof this.subtitleObj.current!="undefined"){var a=this.subtitleObj.current[1].split(" --> ");return this.timecodeToSec(a[1])}},getMinTime:function(){if(typeof this.subtitleObj.current!="undefined"){var a=this.subtitleObj.current[1].split(" --> ");return this.timecodeToSec(a[0])}},getVideoSource:function(b){if(!b){b=this.defaultVideo}if(a.browser.safari&&!/Chrome[\/\s](\d+\.\d+)/.test(navigator.userAgent)||a.browser.msie){return b.source.mp4}if(b.source.ogg){return b.source.ogg}return b.source.webm},hideControls:function(a){a.animate({bottom:"-"+a.height()+"px"})},incrementId:function(){var a=this.options.videoId+this.idCounter;this.idCounter++;return a},muteVideo:function(){var a=this.selector.find(this.getClass("volume-button"));var b=this.selector.find(this.getClass("volume-position"));var c=this.video.get(0);if(c.muted){c.muted=false;a.removeClass("muted");b.height(c.volume*100+"%")}else{c.muted=true;a.addClass("muted");b.height(0)}},playPause:function(){var a=this.video.get(0);if(a.paused){a.play()}else{a.pause()}},resetVideo:function(){this.controls.find(this.getClass("video-controls")+", "+this.getClass("progress-buffer")).css("width",0);clearInterval(this.bufferInterval)},seekTo:function(b,c,d){var e=a(this.getClass("progress-play"));var f=Math.max(0,Math.min(1,(b-this.findPosX(c))/c.width()));d.currentTime=f*d.duration;var g=Math.round(f*c.width());e.width(g)},seekVideoSetup:function(b){var c=a(b).parent().find(this.getClass("progress-wrapper"));if(c.length>0){this.selectable=true;var d=this;c.get(0).addEventListener("mousedown",function(e){e.preventDefault();d.blockSelection();a(document).bind("mousemove",function(a){a.preventDefault();d.seekTo(a.pageX,c,b)});a(document).bind("mouseup",function(b){b.preventDefault();d.unblockSelection();a(document).unbind("mousemove");a(document).unbind("mouseup")})},true);c.get(0).addEventListener("mouseup",function(a){d.seekTo(a.pageX,c,b)},true)}},setClass:function(a){return this.options.prefix+a},setProgressEvents:function(b){var c=this;var d=a(this.getClass("progress-play"));var e=a(this.getClass("progress-buffer"));b.addEventListener("seeked",function(){if(!b.paused)b.play();if(c.subtitleObj&&c.subtitleObj.loaded){c.adjustSubtitle(this)}if(c.options.onSeek){c.options.onSeek.call()}},true);b.addEventListener("ended",function(){d.width("100%");clearInterval(c.progressInterval);this.currentTime=0;this.pause();if(c.options.onEnd){c.options.onEnd.call()}c.playing=false},true);b.addEventListener("timeupdate",function(){c.updateVideoData(this,d);c.updateCurrentTime(this);if(c.subtitleObj&&c.subtitleObj.loaded){c.updateSubtitle(b)}},false);b.addEventListener("play",function(){c.bufferInterval=setInterval(function(){c.updateBuffer(b,e)},1e3);a(this).parent().find(c.getClass("play")).removeClass("paused").addClass("playing");c.seekVideoSetup(b);if(c.options.onPlay){c.options.onPlay.call()}c.playing=true},true);b.addEventListener("pause",function(){a(this).parent().find(c.getClass("play")).removeClass("playing").addClass("paused");if(c.options.onPause){c.options.onPause.call()}c.playing=false},true)},setupProgressBar:function(){var a=this.selector.find(this.getClass("progress-bar"));var b=a.parent().width()-this.getControlsSize();a.width(b)},setupSubtitles:function(){var b=this;this.subtitleObj={};var c=this.video.find("track").attr("src");if(c){a.ajax({url:c,success:function(a){b.subtitleObj.loaded=true;b.subtitlesToArray(a);b.subtitleObj.count=0;b.subtitleObj.current=b.subtitleObj.content[b.subtitleObj.count]}});var d=a('<div id="subtitle-'+this.selector.attr("id")+'" class="'+this.setClass("subtitle")+'"></div>');var e=a('<div class="'+this.setClass("subtitle-content")+'"></div>');d.append(e);this.subtitleObj.element=d;this.selector.append(this.subtitleObj.element)}},setupTime:function(){var a=this.selector.find(this.getClass("time-display"));a.find(this.getClass("time-current")).html(this.formatTime(0));a.find(this.getClass("time-separator")).html(this.options.timeSeparator);a.find(this.getClass("time-total")).html(this.formatTime(this.video.get(0).duration))},subtitlesToArray:function(a){this.subtitleObj.content=[];var b=a.search("\r\n")==-1?"\n":"\r\n";var c=a.split(b+b);for(var d=0;d<c.length;d++){if(c[d].length>0){this.subtitleObj.content.push(c[d].split(b))}}},timecodeToSec:function(a){if(a){tc1=a.split(",");tc2=tc1[0].split(":");seconds=Math.floor(tc2[0]*60*60)+Math.floor(tc2[1]*60)+Math.floor(tc2[2]);return seconds}},toFullscreen:function(){if(!this.fullscreen){if(this.selector.get(0).webkitRequestFullScreen){this.selector.get(0).webkitRequestFullScreen()}else if(this.selector.get(0).mozRequestFullScreen){this.selector.get(0).mozRequestFullScreen()}a(this.getClass("fullscreen")).removeClass("hover");this.fullscreen=true}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}a(this.getClass("fullscreen")).removeClass("hover");this.fullscreen=false}},unblockSelection:function(){document.onselectstart=function(){return true}},updateBuffer:function(a,b){if(a.buffered&&a.buffered.length>0){var c=a.buffered.end(0)/a.duration*100+"%";b.width(c)}else{b.width("100%");clearInterval(this.bufferInterval)}},updateCurrentTime:function(b){var c=a(b).parent().find(this.getClass("time-current"));c.html(this.formatTime(b.currentTime))},updateSubtitle:function(a){var b=a.currentTime;if(b>this.getMinTime()&&b<this.getMaxTime()){this.subtitleObj.current=this.subtitleObj.content[this.subtitleObj.count];this.subtitleObj.subtitle=this.subtitleObj.current[2]}else{this.subtitleObj.subtitle=""}if(b>this.getMaxTime()){this.subtitleObj.count++;this.subtitleObj.current=this.subtitleObj.content[this.subtitleObj.count]}this.subtitleObj.element.find("div:first").html(this.subtitleObj.subtitle)},updateVideoData:function(a,b){var c=b.parent().find(this.getClass("progress-pointer"));var d=a.currentTime*100/a.duration;b.width(d+"%");c.css("left",d+"%")},volumeSetup:function(){var b=this.video.get(0);var c=this.selector.find(this.getClass("volume-wrapper"));var d=this;c.bind("mousedown",function(e){e.preventDefault();d.blockSelection();a(document).bind("mousemove",function(a){a.preventDefault();d.volumeTo(a.pageY,c,b)});a(document).bind("mouseup",function(b){b.preventDefault();d.unblockSelection();a(document).unbind("mousemove");a(document).unbind("mouseup")})});c.bind("mouseup",function(a){d.volumeTo(a.pageY,c,b)})},volumeTo:function(b,c,d){var e=a(this.getClass("volume-position"));var f=Math.max(0,Math.min(1,(b-c.offset().top)/c.height()));var g=(f-1)*-1;d.volume=g;e.height(g*100+"%");var h=a(this.getClass("volume-button"));if(g<=0){h.addClass("muted")}else{h.removeClass("muted")}}};a.fn.jQPlayer=function(c){var d={controls:["play","progress","time","volume","fullscreen","alternative"],controlsClass:"video-controls",customButtons:{},defaultVideo:"standard",floatControls:false,onEnd:false,onPause:false,onPlay:false,onSeek:false,onStart:false,onVideoChange:false,prefix:"html-player-",timeSeparator:"/",videoId:"video-"};var c=a.extend(d,c);return new b(this,c)}})(jQuery)